<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Avalon - Fixed & Finalized</title>
    <style>
        :root { --primary: #e94560; --bg: #1a1a2e; --card: #16213e; --accent: #f1c40f; --blue: #3498db; --red: #e74c3c; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: #e9e9e9; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 50px; }
        
        .quest-tracker { display: flex; justify-content: center; gap: 10px; padding: 15px; background: rgba(0,0,0,0.8); width: 100%; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 50; }
        .quest-node { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #555; display: flex; align-items: center; justify-content: center; font-weight: bold; background: #222; }
        .node-active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .node-success { background: var(--blue) !important; border-color: white !important; }
        .node-fail { background: var(--red) !important; border-color: white !important; }
        
        .reject-counter { background: #000; color: var(--accent); padding: 5px 15px; font-size: 0.8em; border-radius: 20px; margin-top: 10px; border: 1px solid var(--accent); }

        .main-container { width: 100%; max-width: 550px; padding: 20px; }
        .card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #0f3460; }
        .btn { background: var(--primary); border: none; color: white; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .player-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; align-items: center; }
        .info-tag { font-size: 0.8em; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: white; }

        .log-section { background: #000; padding: 15px; border-radius: 8px; font-size: 0.82em; max-height: 300px; overflow-y: auto; border: 1px solid #444; margin-top: 10px; }
        .log-entry { margin-bottom: 15px; padding: 10px; border-radius: 6px; background: #111; border-left: 4px solid #444; }
        .log-mission-success { border-left-color: var(--blue); }
        .log-mission-fail { border-left-color: var(--red); }
        .log-header { font-weight: bold; color: var(--accent); margin-bottom: 5px; }
        .log-vote-list { color: #aaa; font-size: 0.9em; line-height: 1.4; border-top: 1px solid #222; margin-top: 5px; padding-top: 5px; }
        
        #vote-result-screen, #waiting-screen, #action-choice { display: none; text-align: center; }
        .overlay-result { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 5em; font-weight: bold; z-index: 3000; display: none; pointer-events: none; }
        #assassin-announce { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

<div class="quest-tracker">
    <div class="quest-node" id="node-1">1</div>
    <div class="quest-node" id="node-2">2</div>
    <div class="quest-node" id="node-3">3</div>
    <div class="quest-node" id="node-4">4</div>
    <div class="quest-node" id="node-5">5</div>
</div>
<div id="reject-display" class="reject-counter" style="display:none;">å¦æ±ºå›æ•°: <span id="reject-count">0</span> / 5</div>

<div id="overlay" class="overlay-result"></div>

<div class="main-container">
    <div id="setup-screen" class="card">
        <h3>GMè¨­å®š</h3>
        <select id="p-count" onchange="updateSetupTable()" style="width:100%; padding:10px; margin-bottom:15px; background:#333; color:white;">
            <option value="6">6äºº (4:2)</option><option value="7">7äºº (4:3)</option><option value="8">8äºº (5:3)</option><option value="9">9äºº (6:3)</option><option value="10">10äºº (6:4)</option>
        </select>
        <div id="role-setup-area"></div>
        <button class="btn" onclick="startGame()">å†’é™ºã‚’é–‹å§‹</button>
    </div>

    <div id="game-screen" style="display:none;">
        <div class="card" id="my-role-card">
            <h3>å½¹è·: <span id="my-role-name" style="color:var(--accent)">???</span></h3>
            <div id="role-purpose" style="font-weight:bold; color:var(--accent); margin-bottom:5px;"></div>
            <div id="role-desc" style="font-size:0.85em; padding:10px; background:rgba(0,0,0,0.4); border-radius:5px; line-height:1.5;"></div>
        </div>

        <div id="vote-result-screen" class="card">
            <h3 id="vote-title">æŠ•ç¥¨çµæœ</h3>
            <div id="vote-details-list" style="text-align:left; margin-bottom:15px;"></div>
            <button class="btn" id="vote-next-btn">æ¬¡ã¸</button>
        </div>

        <div id="waiting-screen" class="card">
            <h3 style="color:var(--accent);">é å¾é€²è¡Œä¸­...</h3>
            <p>ãƒ¡ãƒ³ãƒãƒ¼ãŒè–æ¯ã‚’é¸å®šã—ã¦ã„ã¾ã™ã€‚</p>
        </div>

        <div id="vote-area" class="card" style="display:none;">
            <h3 style="color:var(--accent);">ãƒãƒ¼ãƒ æ‰¿èªæŠ•ç¥¨</h3>
            <p id="proposed-members"></p>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:var(--blue);" onclick="submitVote(true)">æ‰¿èª</button>
                <button class="btn" style="background:var(--red);" onclick="submitVote(false)">å´ä¸‹</button>
            </div>
        </div>

        <div id="action-choice" class="card" style="border:2px solid var(--accent);">
            <h3 id="action-choice-title" style="text-align:center;">ä»»å‹™ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
            <div id="action-btns" style="display:flex; gap:10px;"></div>
        </div>

        <div id="proposal-area" class="card">
            <h3 id="round-title">ç¬¬1é å¾</h3>
            <div id="member-list"></div>
            <button id="action-btn" class="btn" onclick="proposeTeam()">ãƒãƒ¼ãƒ ã‚’ææ¡ˆã™ã‚‹</button>
        </div>

        <h4>ğŸ“œ é å¾ãƒ»æŠ•ç¥¨å±¥æ­´ãƒ­ã‚°</h4>
        <div class="log-section" id="game-log"></div>
    </div>
</div>

<div id="assassin-announce"><div id="assassin-reveal-text" style="font-size:1.8em; padding:20px;"></div></div>

<div id="result-screen" style="position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:6000; display:none; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
    <h1 id="winner-text" style="font-size:3em;"></h1>
    <div class="card" style="width:100%; max-width:400px;"><table id="final-roles" style="width:100%;"></table></div>
    <button class="btn" style="width:200px;" onclick="location.reload()">å†æŒ‘æˆ¦</button>
</div>

<script>
    let players = [], currentRound = 1, leaderIdx = 0, selectedIds = [], scoreGood = 0, scoreEvil = 0;
    let rejectCount = 0;
    const questMap = { 6:[2,3,4,3,4], 7:[2,3,3,4,4], 8:[3,4,4,5,5], 9:[3,4,4,5,5], 10:[3,4,4,5,5] };
    let currentLogEntry = null;

    function updateSetupTable() {
        const count = parseInt(document.getElementById('p-count').value);
        const gCount = (count >= 9) ? 6 : (count === 8) ? 5 : 4;
        const eCount = count - gCount;
        let html = `<p><b>æ­£ç¾© (${gCount})</b>: ãƒãƒ¼ãƒªãƒ³ + `;
        for(let i=0; i<gCount-1; i++) html += `<select class="g-role" onchange="checkUnique(this)"><option value="æ­£ç¾©ã®å¿ è‡£">å¿ è‡£</option><option value="ãƒ‘ãƒ¼ã‚·ãƒ´ã‚¡ãƒ«">ãƒ‘ãƒ¼ã‚·ãƒ´ã‚¡ãƒ«</option></select> `;
        html += `</p><p><b>é‚ªæ‚ª (${eCount})</b>: æš—æ®ºè€… + `;
        for(let i=0; i<eCount-1; i++) html += `<select class="e-role" onchange="checkUnique(this)"><option value="é‚ªæ‚ªã®æ‰‹å…ˆ">æ‰‹å…ˆ</option><option value="ãƒ¢ãƒ«ã‚¬ãƒŠ">ãƒ¢ãƒ«ã‚¬ãƒŠ</option><option value="ã‚ªãƒ™ãƒ­ãƒ³">ã‚ªãƒ™ãƒ­ãƒ³</option><option value="ãƒ¢ãƒ¼ãƒ‰ãƒ¬ãƒƒãƒ‰">ãƒ¢ãƒ¼ãƒ‰ãƒ¬ãƒƒãƒ‰</option></select> `;
        document.getElementById('role-setup-area').innerHTML = html;
    }

    function checkUnique(el) {
        let count = 0; document.querySelectorAll('select').forEach(s => { if(s.value === el.value && !s.value.includes("å¿ è‡£") && !s.value.includes("æ‰‹å…ˆ")) count++; });
        if(count > 1) { alert("ç‰¹æ®Šå½¹è·ã¯1äººã¾ã§"); el.value = el.className === "g-role" ? "æ­£ç¾©ã®å¿ è‡£" : "é‚ªæ‚ªã®æ‰‹å…ˆ"; }
    }

    function startGame() {
        let pool = ["ãƒãƒ¼ãƒªãƒ³", "æš—æ®ºè€…"];
        document.querySelectorAll('.g-role, .e-role').forEach(s => pool.push(s.value));
        pool = pool.sort(() => Math.random() - 0.5);
        players = pool.map((r, i) => ({ id: i, name: i === 0 ? "ãŸã‘(You)" : `NPC-${i}`, role: r, side: ["æš—æ®ºè€…", "ãƒ¢ãƒ«ã‚¬ãƒŠ", "ã‚ªãƒ™ãƒ­ãƒ³", "ãƒ¢ãƒ¼ãƒ‰ãƒ¬ãƒƒãƒ‰", "é‚ªæ‚ªã®æ‰‹å…ˆ"].includes(r) ? "Evil" : "Good" }));
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('reject-display').style.display = 'block';
        refreshUI();
    }

    function refreshUI() {
        const my = players[0];
        document.getElementById('my-role-name').innerText = my.role;
        document.getElementById('round-title').innerText = `ç¬¬${currentRound}é å¾ (å¿…è¦:${questMap[players.length][currentRound-1]}å)`;
        document.getElementById('reject-count').innerText = rejectCount;

        // --- ã‚¹ã‚­ãƒ«ã¨ç›®çš„ã®è¡¨è¨˜ ---
        let purpose = "";
        let desc = "";
        if (my.side === "Good") {
            purpose = "ã€ç›®çš„ã€‘é å¾ã‚’3å›æˆåŠŸã•ã›ã‚ˆï¼";
            if (my.role === "ãƒãƒ¼ãƒªãƒ³") desc = "ã€ã‚¹ã‚­ãƒ«ã€‘é‚ªæ‚ªãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ¢ãƒ¼ãƒ‰ãƒ¬ãƒƒãƒ‰ä»¥å¤–ï¼‰ãŒèª°ã‹è¦‹ãˆã¦ã„ã¾ã™ã€‚æš—æ®ºè€…ã«ãƒãƒ¬ã‚‹ã¨é€†è»¢æ•—åŒ—ã—ã¾ã™ã€‚";
            else if (my.role === "ãƒ‘ãƒ¼ã‚·ãƒ´ã‚¡ãƒ«") desc = "ã€ã‚¹ã‚­ãƒ«ã€‘ãƒãƒ¼ãƒªãƒ³ã¨ãƒ¢ãƒ«ã‚¬ãƒŠã®2äººãŒèª°ã‹è¦‹ãˆã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ãŒæœ¬ç‰©ã‹ã¯åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚";
            else desc = "ã€ã‚¹ã‚­ãƒ«ã€‘ç‰¹åˆ¥ãªåŠ›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è­°è«–ã§é‚ªæ‚ªã‚’è¦‹ã¤ã‘å‡ºã—ã€é å¾ã‚’æˆåŠŸã•ã›ã¾ã—ã‚‡ã†ã€‚";
        } else {
            purpose = "ã€ç›®çš„ã€‘é å¾ã‚’3å›å¤±æ•—ã•ã›ã‚‹ã‹ã€æœ€å¾Œã«ãƒãƒ¼ãƒªãƒ³ã‚’æš—æ®ºã›ã‚ˆï¼";
            if (my.role === "æš—æ®ºè€…") desc = "ã€ã‚¹ã‚­ãƒ«ã€‘ä»²é–“ã®é‚ªæ‚ªãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚ªãƒ™ãƒ­ãƒ³ä»¥å¤–ï¼‰ãŒè¦‹ãˆã¦ã„ã¾ã™ã€‚æœ€å¾Œã«ãƒãƒ¼ãƒªãƒ³ã‚’æŒ‡åã§ãã‚Œã°å‹åˆ©ï¼";
            else if (my.role === "ã‚ªãƒ™ãƒ­ãƒ³") desc = "ã€ã‚¹ã‚­ãƒ«ã€‘ã‚ãªãŸã¯é‚ªæ‚ªã§ã™ãŒã€ä»–ã®ä»²é–“ã‚’çŸ¥ã‚‹ã“ã¨ã‚‚ã€çŸ¥ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚";
            else desc = "ã€ã‚¹ã‚­ãƒ«ã€‘ä»²é–“ã®é‚ªæ‚ªãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚ªãƒ™ãƒ­ãƒ³ä»¥å¤–ï¼‰ãŒè¦‹ãˆã¦ã„ã¾ã™ã€‚å”åŠ›ã—ã¦é å¾ã‚’é˜»æ­¢ã—ã¾ã—ã‚‡ã†ã€‚";
        }
        document.getElementById('role-purpose').innerText = purpose;
        document.getElementById('role-desc').innerText = desc;

        document.getElementById('member-list').innerHTML = players.map((p, i) => {
            let tag = "";
            if(my.role === "ãƒãƒ¼ãƒªãƒ³" && p.side === "Evil" && p.role !== "ãƒ¢ãƒ¼ãƒ‰ãƒ¬ãƒƒãƒ‰") tag = '<span class="info-tag" style="background:var(--red)">ğŸ‘¿</span>';
            if(my.role === "ãƒ‘ãƒ¼ã‚·ãƒ´ã‚¡ãƒ«" && ["ãƒãƒ¼ãƒªãƒ³", "ãƒ¢ãƒ«ã‚¬ãƒŠ"].includes(p.role)) tag = '<span class="info-tag" style="background:var(--blue)">â“</span>';
            if(my.side === "Evil" && my.role !== "ã‚ªãƒ™ãƒ­ãƒ³" && p.side === "Evil" && p.role !== "ã‚ªãƒ™ãƒ­ãƒ³") tag = '<span class="info-tag" style="background:var(--red)">ğŸ˜ˆ</span>';
            return `<div class="player-row"><span>${i === leaderIdx ? 'ğŸš©' : ''}${p.name} ${tag}</span><input type="checkbox" class="sel" value="${p.id}" onchange="sync()"></div>`;
        }).join('');
        for(let i=1; i<=5; i++) document.getElementById(`node-${i}`).classList.toggle('node-active', i === currentRound);
    }

    function sync() { selectedIds = Array.from(document.querySelectorAll('.sel:checked')).map(el => parseInt(el.value)); }

    function proposeTeam() {
        if(selectedIds.length !== questMap[players.length][currentRound-1]) return alert("äººæ•°ãŒé•ã„ã¾ã™");
        
        const teamNames = selectedIds.map(id => players[id].name).join(", ");
        currentLogEntry = { round: currentRound, leader: players[leaderIdx].name, team: teamNames, votes: [], isApproved: false };

        if(rejectCount >= 4) {
            // 5äººç›®ã®æœ€çµ‚ç¢ºèª
            if (confirm(`ã“ã‚ŒãŒ5å›ç›®ã®ææ¡ˆã§ã™ã€‚æŠ•ç¥¨ãªã—ã§ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ [ ${teamNames} ] ã§é å¾ã‚’é–‹å§‹ã—ã¾ã™ãŒã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
                currentLogEntry.isApproved = true;
                currentLogEntry.voteCount = "å¼·åˆ¶å‡ºç™º";
                startMission();
            }
        } else {
            document.getElementById('proposal-area').style.display = 'none';
            document.getElementById('vote-area').style.display = 'block';
            document.getElementById('proposed-members').innerText = "ææ¡ˆãƒãƒ¼ãƒ : " + currentLogEntry.team;
        }
    }

    // --- ä»¥ä¸‹ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¨ãƒ­ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¤‰æ›´ãªã—ï¼‰ ---
    function submitVote(myApp) {
        let apps = 0; let details = [];
        players.forEach((p, i) => {
            let vote = (i === 0) ? myApp : (Math.random() > 0.45);
            if(vote) apps++;
            let vText = vote ? "æ‰¿èª" : "å´ä¸‹";
            details.push(`${p.name}:${vText}`);
            currentLogEntry.votes.push({ name: p.name, vote: vText });
        });
        currentLogEntry.isApproved = apps > players.length / 2;
        currentLogEntry.voteCount = `${apps}/${players.length}`;
        document.getElementById('vote-area').style.display = 'none';
        document.getElementById('vote-result-screen').style.display = 'block';
        document.getElementById('vote-title').innerText = currentLogEntry.isApproved ? "âœ… ãƒãƒ¼ãƒ æ‰¿èª" : "âŒ ãƒãƒ¼ãƒ å´ä¸‹";
        document.getElementById('vote-details-list').innerHTML = details.join("<br>");
        document.getElementById('vote-next-btn').onclick = () => {
            document.getElementById('vote-result-screen').style.display = 'none';
            if(currentLogEntry.isApproved) { startMission(); } else { writeLogToScreen(false); rejectCount++; leaderIdx = (leaderIdx + 1) % players.length; document.getElementById('proposal-area').style.display = 'block'; refreshUI(); }
        };
    }
    function startMission() {
        document.getElementById('proposal-area').style.display = 'none'; rejectCount = 0; 
        if(selectedIds.includes(0)) {
            const my = players[0]; document.getElementById('action-choice').style.display = 'block';
            let btns = `<button class="btn" style="background:var(--blue);" onclick="handleMissionAction(true)">æˆåŠŸ</button>`;
            if(my.side === "Evil") btns += `<button class="btn" style="background:var(--red);" onclick="handleMissionAction(false)">å¤±æ•—</button>`;
            document.getElementById('action-btns').innerHTML = btns;
        } else { document.getElementById('waiting-screen').style.display = 'block'; setTimeout(() => processNPCMission(), 2000); }
    }
    function handleMissionAction(isSuccess) {
        document.getElementById('action-choice').style.display = 'none'; document.getElementById('waiting-screen').style.display = 'block';
        setTimeout(() => { let f = selectedIds.filter(id => id !== 0 && players[id].side === "Evil" && Math.random() > 0.45).length; showMissionResult(isSuccess ? f : f + 1); }, 1000);
    }
    function processNPCMission() { let f = selectedIds.filter(id => players[id].side === "Evil" && Math.random() > 0.45).length; showMissionResult(f); }
    function showMissionResult(fails) {
        document.getElementById('waiting-screen').style.display = 'none';
        let success = (currentRound === 4 && players.length >= 7) ? (fails < 2) : (fails === 0);
        currentLogEntry.missionSuccess = success; currentLogEntry.failCards = fails;
        const ov = document.getElementById('overlay'); ov.innerText = success ? "SUCCESS" : "FAIL"; ov.style.color = success ? "var(--blue)" : "var(--red)"; ov.style.display = "block";
        document.getElementById(`node-${currentRound}`).classList.add(success ? 'node-success' : 'node-fail');
        if(success) scoreGood++; else scoreEvil++;
        writeLogToScreen(true);
        setTimeout(() => { ov.style.display = "none"; if(scoreEvil >= 3) finalizeGame("Evil"); else if(scoreGood >= 3) startAssassinPhase(); else { currentRound++; leaderIdx = (leaderIdx + 1) % players.length; document.getElementById('proposal-area').style.display = 'block'; refreshUI(); selectedIds = []; } }, 2000);
    }
    function writeLogToScreen(isMissionHandled) {
        const log = document.getElementById('game-log');
        let statusClass = isMissionHandled ? (currentLogEntry.missionSuccess ? "log-mission-success" : "log-mission-fail") : "";
        let missionInfo = isMissionHandled ? `<div style="color:${currentLogEntry.missionSuccess?'var(--blue)':'var(--red)'}; font-weight:bold;">â” é å¾: ${currentLogEntry.missionSuccess?'æˆåŠŸ':'å¤±æ•—'} (${currentLogEntry.failCards})</div>` : "";
        log.innerHTML = `<div class="log-entry ${statusClass}"><div class="log-header">R${currentLogEntry.round}: ${currentLogEntry.leader}</div><div>ãƒãƒ¼ãƒ : ${currentLogEntry.team}</div><div>æŠ•ç¥¨: ${currentLogEntry.isApproved ? 'æ‰¿èª' : 'å´ä¸‹'} (${currentLogEntry.voteCount})</div>${missionInfo}<div class="log-vote-list">${currentLogEntry.votes.map(v => v.name + ":" + v.vote).join(" / ")}</div></div>` + log.innerHTML;
    }
    function startAssassinPhase() {
        document.getElementById('proposal-area').style.display = 'none';
        document.getElementById('game-screen').innerHTML = `<div class="card"><h3>ğŸ—¡ï¸ æš—æ®ºãƒ•ã‚§ãƒ¼ã‚º</h3><p id="ass-msg">æš—æ®ºè€…ãŒãƒãƒ¼ãƒªãƒ³ã‚’æŒ‡åã—ã¾ã™ã€‚</p><div id="t-list"></div></div>`;
        const ass = players.find(p => p.role === "æš—æ®ºè€…");
        if(ass.id === 0) { document.getElementById('t-list').innerHTML = players.filter(p => p.side === "Good").map(p => `<button class="btn" onclick="assassinate(${p.id})">${p.name}</button>`).join(""); }
        else { setTimeout(() => assassinate(players.filter(p => p.side === "Good").sort(() => Math.random() - 0.5)[0].id), 3000); }
    }
    function assassinate(tid) {
        const ass = players.find(p => p.role === "æš—æ®ºè€…"); document.getElementById('assassin-announce').style.display = 'flex';
        document.getElementById('assassin-reveal-text').innerHTML = `æš—æ®ºè€… <b>${ass.name}</b> ã¯<br><b>${players[tid].name}</b> ã‚’æŒ‡åï¼`;
        setTimeout(() => { document.getElementById('assassin-announce').style.display = 'none'; finalizeGame(players[tid].role === "ãƒãƒ¼ãƒªãƒ³" ? "AssassinWin" : "GoodWin"); }, 4000);
    }
    function finalizeGame(winner) {
        document.getElementById('result-screen').style.display = 'flex';
        const winText = document.getElementById('winner-text'); winText.innerText = winner === "GoodWin" ? "æ­£ç¾©ã®å‹åˆ©ï¼" : "é‚ªæ‚ªã®å‹åˆ©ï¼"; winText.style.color = winner === "GoodWin" ? "var(--blue)" : "var(--red)";
        document.getElementById('final-roles').innerHTML = players.map(p => `<tr><td>${p.name}</td><td style="color:${p.side==='Good'?'var(--blue)':'var(--red)'}">${p.role}</td></tr>`).join('');
    }
    updateSetupTable();
</script>
</body>
</html>
